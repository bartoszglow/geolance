/*! geolance 2014-05-13 */
var app=angular.module("app",["ngRoute","google-maps"]);app.config(["$routeProvider",function(a){a.when("/",{controller:"loginCtrl",templateUrl:"views/login.html"}).when("/map",{controller:"mapCtrl",templateUrl:"views/hospital/map.html"}).when("/ambulance",{controller:"ambulanceCtrl",templateUrl:"views/ambulance/ambulance.html"}).otherwise({redirectTo:"/"})}]),app.factory("AuthenticationService",["$location","$http","$q",function(a,b,c){var d={};return{login:function(e){var f=c.defer();return"dispatcher"===e.username&&"password"===e.password?(console.log(a),a.path("/map")):b.post("/geolance/php/login",{username:e.username,password:e.password}).success(function(b){""!==b.username?(d=b,a.path("/ambulance"),f.resolve()):f.reject(b.error)}).error(function(){}),f.promise},logout:function(){a.path("/")},getUsername:function(){return d.username}}}]),app.controller("ambulanceCtrl",["$scope","$location","$http","AuthenticationService",function(a,b,c,d){a.status=!0,a.access=!1,a.update=function(){a.status===!0&&navigator.geolocation.getCurrentPosition(function(b){var e={username:d.getUsername(),access:a.access===!1?0:1,latitude:b.coords.latitude,longitude:b.coords.longitude,accuracy:b.coords.accuracy};c.post("/geolance/php/update",e),a.timeout=setTimeout(a.update,1e4)})},a.statusChange=function(){a.status=$("#status:checked")[0]?!0:!1,$(".toogled").toggleClass("hidden"),window.clearTimeout(a.timeout),a.update()},a.accessChange=function(){a.access=$("#access:checked")[0]?!0:!1},a.logout=function(){d.logout()},window.scope=a,a.statusChange(),a.update()}]),app.controller("loginCtrl",["$scope","AuthenticationService","$q",function(a,b){a.credentials={username:"",password:""},a.error="jestfdsfsd",$(".alert").hide(),window.scope=a,a.login=function(){a.promise=b.login(a.credentials),a.promise.then(function(){},function(b){a.error=b,a.showError()})},a.showError=function(){$(".alert").show(),setInterval(function(){$(".alert").hide()},3e3)}}]),app.controller("mapCtrl",["$scope",function(a){a.map={zoom:12,center:{latitude:52.405137,longitude:16.932222}}}]);